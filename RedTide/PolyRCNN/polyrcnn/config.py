from detectron2.config import CfgNode as CN

def add_polyrcnn_config(cfg):
    """
    添加 PolyRCNN 模型的特定配置
    """
    cfg.MODEL.PolyRCNN = CN()
    cfg.MODEL.PolyRCNN.NUM_CLASSES = 1  # 分类的类别数量
    cfg.MODEL.PolyRCNN.NUM_PROPOSALS = 100  # 每个图像的提议多边形数量
    cfg.MODEL.PolyRCNN.NUM_CORNERS = 200  # 每个多边形的顶点数量 96
    # RCNN Head.
    cfg.MODEL.PolyRCNN.NHEADS = 8  # 多头自注意力的头数
    cfg.MODEL.PolyRCNN.DROPOUT = 0.0  # 丢弃率
    cfg.MODEL.PolyRCNN.DIM_FEEDFORWARD = 2048  # 前馈网络的维度
    cfg.MODEL.PolyRCNN.ACTIVATION = 'relu'  # 激活函数
    cfg.MODEL.PolyRCNN.HIDDEN_DIM = 256  # 隐藏层的维度
    cfg.MODEL.PolyRCNN.NUM_CLS = 1  # 分类相关的参数
    cfg.MODEL.PolyRCNN.NUM_REG = 3  # 回归相关的参数
    cfg.MODEL.PolyRCNN.NUM_COR = 3  # 角点相关的参数
    cfg.MODEL.PolyRCNN.NUM_POL = 3  # 多边形相关的参数
    cfg.MODEL.PolyRCNN.NUM_HEADS = 6  # 迭代优化的次数

    # Dynamic Conv.
    cfg.MODEL.PolyRCNN.NUM_DYNAMIC = 2  # 动态卷积的数量
    cfg.MODEL.PolyRCNN.DIM_DYNAMIC = 64  # 动态卷积的维度

    # Loss.
    cfg.MODEL.PolyRCNN.CLASS_WEIGHT = 2.0  # 分类损失的权重
    cfg.MODEL.PolyRCNN.GIOU_WEIGHT = 2.0  # GIoU损失的权重
    cfg.MODEL.PolyRCNN.L1_WEIGHT = 5.0  # L1损失的权重
    cfg.MODEL.PolyRCNN.DEEP_SUPERVISION = True  # 是否启用深度监督
    cfg.MODEL.PolyRCNN.NO_OBJECT_WEIGHT = 0.1  # 无目标的权重

    # Focal Loss.
    cfg.MODEL.PolyRCNN.USE_FOCAL = True  # 是否使用焦点损失
    cfg.MODEL.PolyRCNN.ALPHA = 0.25  # 焦点损失的α参数
    cfg.MODEL.PolyRCNN.GAMMA = 2.0  # 焦点损失的γ参数
    cfg.MODEL.PolyRCNN.PRIOR_PROB = 0.01  # 先验概率

    # Swin Backbones
    cfg.MODEL.SWIN = CN()
    cfg.MODEL.SWIN.SIZE = 'B'  # 'T', 'S', 'B'  # Swin骨干网络的大小
    cfg.MODEL.SWIN.USE_CHECKPOINT = False  # 是否使用检查点
    cfg.MODEL.SWIN.OUT_FEATURES = (0, 1, 2, 3)  # # Swin骨干网络的输出特征层

    # Optimizer.
    cfg.SOLVER.OPTIMIZER = "ADAMW"  # 优化器类型
    cfg.SOLVER.BACKBONE_MULTIPLIER = 1.0  # 骨干网络学习率的乘数

    # TTA.
    cfg.TEST.AUG.MIN_SIZES = (400, 500, 600, 640, 700, 900, 1000, 1100, 1200, 1300, 1400, 1800, 800)  # 测试时数据增强的最小尺寸
    # cfg.TEST.AUG.MIN_SIZES = (256,)
    cfg.TEST.AUG.CVPODS_TTA = True  # 是否使用CVPODS的测试时数据增强
    cfg.TEST.AUG.SCALE_FILTER = True  # 是否使用尺度过滤
    cfg.TEST.AUG.SCALE_RANGES = ([96, 10000], [96, 10000],
                                 [64, 10000], [64, 10000],
                                 [64, 10000], [0, 10000],
                                 [0, 10000], [0, 256],
                                 [0, 256], [0, 192],
                                 [0, 192], [0, 96],
                                 [0, 10000])  # 测试时数据增强的尺度范围
    # cfg.TEST.AUG.SCALE_RANGES = ([256, 256],)  # 调整为输入图像的尺寸范围

    # 初始化提议多边形
    # 96 uniform sampled vertices from the contour of a 0.5*0.5 rectangle in the center of a 1*1 rectangle.
    # cfg.INIT_POLYGON = [0.2500, 0.2500, 0.2500, 0.2679, 0.2500, 0.2857, 0.2500, 0.3125, 0.2500,
    #                     0.3304, 0.2500, 0.3482, 0.2500, 0.3661, 0.2500, 0.3929, 0.2500, 0.4107,
    #                     0.2500, 0.4286, 0.2500, 0.4464, 0.2500, 0.4732, 0.2500, 0.4911, 0.2500,
    #                     0.5089, 0.2500, 0.5268, 0.2500, 0.5446, 0.2500, 0.5714, 0.2500, 0.5893,
    #                     0.2500, 0.6071, 0.2500, 0.6250, 0.2500, 0.6518, 0.2500, 0.6696, 0.2500,
    #                     0.6875, 0.2500, 0.7054, 0.2500, 0.7321, 0.2500, 0.7500, 0.2696, 0.7500,
    #                     0.2892, 0.7500, 0.3088, 0.7500, 0.3382, 0.7500, 0.3578, 0.7500, 0.3775,
    #                     0.7500, 0.3971, 0.7500, 0.4265, 0.7500, 0.4461, 0.7500, 0.4657, 0.7500,
    #                     0.4853, 0.7500, 0.5049, 0.7500, 0.5343, 0.7500, 0.5539, 0.7500, 0.5735,
    #                     0.7500, 0.5931, 0.7500, 0.6225, 0.7500, 0.6422, 0.7500, 0.6618, 0.7500,
    #                     0.6814, 0.7500, 0.7108, 0.7500, 0.7304, 0.7500, 0.7500, 0.7500, 0.7500,
    #                     0.7321, 0.7500, 0.7143, 0.7500, 0.6875, 0.7500, 0.6696, 0.7500, 0.6518,
    #                     0.7500, 0.6339, 0.7500, 0.6071, 0.7500, 0.5893, 0.7500, 0.5714, 0.7500,
    #                     0.5536, 0.7500, 0.5268, 0.7500, 0.5089, 0.7500, 0.4911, 0.7500, 0.4732,
    #                     0.7500, 0.4554, 0.7500, 0.4286, 0.7500, 0.4107, 0.7500, 0.3929, 0.7500,
    #                     0.3750, 0.7500, 0.3482, 0.7500, 0.3304, 0.7500, 0.3125, 0.7500, 0.2946,
    #                     0.7500, 0.2768, 0.7500, 0.2500, 0.7304, 0.2500, 0.7108, 0.2500, 0.6912,
    #                     0.2500, 0.6618, 0.2500, 0.6422, 0.2500, 0.6225, 0.2500, 0.6029, 0.2500,
    #                     0.5735, 0.2500, 0.5539, 0.2500, 0.5343, 0.2500, 0.5147, 0.2500, 0.4951,
    #                     0.2500, 0.4657, 0.2500, 0.4461, 0.2500, 0.4265, 0.2500, 0.4069, 0.2500,
    #                     0.3775, 0.2500, 0.3578, 0.2500, 0.3382, 0.2500, 0.3186, 0.2500, 0.2892,
    #                     0.2500, 0.2696, 0.2500]
    # 60 uniform sampled vertices from the contour of a 0.5*0.5 rectangle in the center of a 1*1 rectangle.
    # cfg.INIT_POLYGON = [0.2475, 0.2475, 0.2475, 0.2809, 0.2475, 0.3144, 0.2475, 0.3478, 0.2475, 0.3813, 0.2475,
    #                     0.4147, 0.2475, 0.4482, 0.2475, 0.4816, 0.2475, 0.5151, 0.2475, 0.5485, 0.2475, 0.5819,
    #                     0.2475, 0.6154, 0.2475, 0.6488, 0.2475, 0.6823, 0.2475, 0.7157, 0.2475, 0.7492, 0.2809,
    #                     0.7492, 0.3144, 0.7492, 0.3478, 0.7492, 0.3813, 0.7492, 0.4147, 0.7492, 0.4482, 0.7492,
    #                     0.4816, 0.7492, 0.5151, 0.7492, 0.5485, 0.7492, 0.5819, 0.7492, 0.6154, 0.7492, 0.6488,
    #                     0.7492, 0.6823, 0.7492, 0.7157, 0.7492, 0.7492, 0.7492, 0.7492, 0.7157, 0.7492, 0.6823,
    #                     0.7492, 0.6488, 0.7492, 0.6154, 0.7492, 0.5819, 0.7492, 0.5485, 0.7492, 0.5151, 0.7492,
    #                     0.4816, 0.7492, 0.4482, 0.7492, 0.4147, 0.7492, 0.3813, 0.7492, 0.3478, 0.7492, 0.3144,
    #                     0.7492, 0.2809, 0.7492, 0.2475, 0.7157, 0.2475, 0.6823, 0.2475, 0.6488, 0.2475, 0.6154,
    #                     0.2475, 0.5819, 0.2475, 0.5485, 0.2475, 0.5151, 0.2475, 0.4816, 0.2475, 0.4482, 0.2475,
    #                     0.4147, 0.2475, 0.3813, 0.2475, 0.3478, 0.2475, 0.3144, 0.2475, 0.2809, 0.2475]

    # 200
    cfg.INIT_POLYGON = [0.2500, 0.2500, 0.2500, 0.2679, 0.2500, 0.2857, 0.2500, 0.3125, 0.2500,
                        0.3304, 0.2500, 0.3482, 0.2500, 0.3661, 0.2500, 0.3929, 0.2500, 0.4107,
                        0.2500, 0.4286, 0.2500, 0.4464, 0.2500, 0.4732, 0.2500, 0.4911, 0.2500,
                        0.5089, 0.2500, 0.5268, 0.2500, 0.5446, 0.2500, 0.5714, 0.2500, 0.5893,
                        0.2500, 0.6071, 0.2500, 0.6250, 0.2500, 0.6518, 0.2500, 0.6696, 0.2500,
                        0.6875, 0.2500, 0.7054, 0.2500, 0.7321, 0.2500, 0.7500, 0.2696, 0.7500,
                        0.2892, 0.7500, 0.3088, 0.7500, 0.3382, 0.7500, 0.3578, 0.7500, 0.3775,
                        0.7500, 0.3971, 0.7500, 0.4265, 0.7500, 0.4461, 0.7500, 0.4657, 0.7500,
                        0.4853, 0.7500, 0.5049, 0.7500, 0.5343, 0.7500, 0.5539, 0.7500, 0.5735,
                        0.7500, 0.5931, 0.7500, 0.6225, 0.7500, 0.6422, 0.7500, 0.6618, 0.7500,
                        0.6814, 0.7500, 0.7108, 0.7500, 0.7304, 0.7500, 0.7500, 0.7500, 0.7500,
                        0.7321, 0.7500, 0.7143, 0.7500, 0.6875, 0.7500, 0.6696, 0.7500, 0.6518,
                        0.7500, 0.6339, 0.7500, 0.6071, 0.7500, 0.5893, 0.7500, 0.5714, 0.7500,
                        0.5536, 0.7500, 0.5268, 0.7500, 0.5089, 0.7500, 0.4911, 0.7500, 0.4732,
                        0.7500, 0.4554, 0.7500, 0.4286, 0.7500, 0.4107, 0.7500, 0.3929, 0.7500,
                        0.3750, 0.7500, 0.3482, 0.7500, 0.3304, 0.7500, 0.3125, 0.7500, 0.2946,
                        0.7500, 0.2768, 0.7500, 0.2500, 0.7304, 0.2500, 0.7108, 0.2500, 0.6912,
                        0.2500, 0.6618, 0.2500, 0.6422, 0.2500, 0.6225, 0.2500, 0.6029, 0.2500,
                        0.5735, 0.2500, 0.5539, 0.2500, 0.5343, 0.2500, 0.5147, 0.2500, 0.4951,
                        0.2500, 0.4657, 0.2500, 0.4461, 0.2500, 0.4265, 0.2500, 0.4069, 0.2500,
                        0.3775, 0.2500, 0.3578, 0.2500, 0.3382, 0.2500, 0.3186, 0.2500, 0.2892,
                        0.2500, 0.2696, 0.2500, 0.2500, 0.2500, 0.2500, 0.2679, 0.2500, 0.2857, 0.2500, 0.3125, 0.2500,
                        0.3304, 0.2500, 0.3482, 0.2500, 0.3661, 0.2500, 0.3929, 0.2500, 0.4107,
                        0.2500, 0.4286, 0.2500, 0.4464, 0.2500, 0.4732, 0.2500, 0.4911, 0.2500,
                        0.5089, 0.2500, 0.5268, 0.2500, 0.5446, 0.2500, 0.5714, 0.2500, 0.5893,
                        0.2500, 0.6071, 0.2500, 0.6250, 0.2500, 0.6518, 0.2500, 0.6696, 0.2500,
                        0.6875, 0.2500, 0.7054, 0.2500, 0.7321, 0.2500, 0.7500, 0.2696, 0.7500,
                        0.2892, 0.7500, 0.3088, 0.7500, 0.3382, 0.7500, 0.3578, 0.7500, 0.3775,
                        0.7500, 0.3971, 0.7500, 0.4265, 0.7500, 0.4461, 0.7500, 0.4657, 0.7500,
                        0.4853, 0.7500, 0.5049, 0.7500, 0.5343, 0.7500, 0.5539, 0.7500, 0.5735,
                        0.7500, 0.5931, 0.7500, 0.6225, 0.7500, 0.6422, 0.7500, 0.6618, 0.7500,
                        0.6814, 0.7500, 0.7108, 0.7500, 0.7304, 0.7500, 0.7500, 0.7500, 0.7500,
                        0.7321, 0.7500, 0.7143, 0.7500, 0.6875, 0.7500, 0.6696, 0.7500, 0.6518,
                        0.7500, 0.6339, 0.7500, 0.6071, 0.7500, 0.5893, 0.7500, 0.5714, 0.7500,
                        0.5536, 0.7500, 0.5268, 0.7500, 0.5089, 0.7500, 0.4911, 0.7500, 0.4732,
                        0.7500, 0.4554, 0.7500, 0.4286, 0.7500, 0.4107, 0.7500, 0.3929, 0.7500,
                        0.3750, 0.7500, 0.3482, 0.7500, 0.3304, 0.7500, 0.3125, 0.7500, 0.2946,
                        0.7500, 0.2768, 0.7500, 0.2500, 0.7304, 0.2500, 0.7108, 0.2500, 0.6912,
                        0.2500, 0.6618, 0.2500, 0.6422, 0.2500, 0.6225, 0.2500, 0.6029, 0.2500,
                        0.5735, 0.2500, 0.5539, 0.2500, 0.5343, 0.2500, 0.5147, 0.2500, 0.4951,
                        0.2500, 0.4657, 0.2500, 0.4461, 0.2500, 0.4265, 0.2500, 0.4069, 0.2500,
                        0.3775, 0.2500, 0.3578, 0.2500, 0.3382, 0.2500, 0.3186, 0.2500, 0.2892,
                        0.2500, 0.2696, 0.2500, 0.2500, 0.2500, 0.2500, 0.2679, 0.2500, 0.2857, 0.2500, 0.3125, 0.2500,
                        0.3304, 0.2500, 0.3482, 0.2500, 0.3661, 0.2500, 0.3929]